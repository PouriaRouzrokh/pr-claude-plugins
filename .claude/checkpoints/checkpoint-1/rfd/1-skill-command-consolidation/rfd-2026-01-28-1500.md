# RFD-1: Skill-Command Consolidation

## Metadata

- **Created**: 2026-01-28 15:00
- **Last Updated**: 2026-01-28 16:30
- **Status**: Completed
- **Checkpoint**: checkpoint-1

## Feature Request

### Original Request

Remove the workaround where `create-prd` and `create-snapshot` existed as both commands and skills (duplicated content). Convert back to using skills only, since Claude Code has merged skills and commands.

### Clarified Requirements

- Remove duplicate command files that were created as workaround for claude-code#15178
- Let the existing skills at `pr/skills/create-prd/` and `pr/skills/create-snapshot/` handle the slash commands
- Verify that agent references in skills are correct (skills should NOT have their own agents folder)

### Out of Scope

- Changes to the skill content itself
- Changes to agent definitions

## Context

### Background

Commit `d0a8338` introduced a workaround that embedded skill content directly into command files because of a Claude Code bug (#15178). This created duplication:
- `pr/commands/create-prd.md` (450 lines) duplicated `pr/skills/create-prd/SKILL.md`
- `pr/commands/create-snapshot.md` (564 lines) duplicated `pr/skills/create-snapshot/SKILL.md`

### Technical Context

Per Claude Code documentation:
> "Custom slash commands have been merged into skills. A file at `.claude/commands/review.md` and a skill at `.claude/skills/review/SKILL.md` both create `/review` and work the same way."

And: "If a skill and a command share the same name, the skill takes precedence."

### Related Existing Features

- Skills infrastructure at `pr/skills/`
- Commands infrastructure at `pr/commands/`
- Agents at `pr/agents/` (code-explorer, code-architect, code-reviewer)

### Key Files & Components

- `pr/skills/create-prd/SKILL.md` - PRD generation skill
- `pr/skills/create-snapshot/SKILL.md` - Snapshot generation skill
- `pr/skills/create-snapshot/template.md` - Snapshot template
- `pr/agents/code-explorer.md` - Agent used by create-snapshot skill

## Implementation

### Approach

Two-phase approach:
1. Remove duplicate embedded command files (450+ lines each)
2. Re-add thin wrapper commands that invoke skills (6-7 lines each)

### Changes Made

**Phase 1: Remove duplicates**
1. **Deleted** `pr/commands/create-prd.md` (450 lines of embedded skill content)
2. **Deleted** `pr/commands/create-snapshot.md` (564 lines of embedded skill content)

Total: 1014 lines of duplicate content removed.

**Phase 2: Add wrapper commands**
1. **Created** `pr/commands/create-prd.md` (7 lines) - delegates to `pr:create-prd` skill
2. **Created** `pr/commands/create-snapshot.md` (7 lines) - delegates to `pr:create-snapshot` skill

### Final Architecture

```
Commands (entry points)          Skills (workflow logic)
─────────────────────           ────────────────────────
pr/commands/create-prd.md   →   pr/skills/create-prd/SKILL.md
pr/commands/create-snapshot.md → pr/skills/create-snapshot/SKILL.md
```

Commands are thin wrappers with frontmatter (description, argument-hint) and a single instruction to invoke the skill. Skills contain the full workflow logic and supporting files.

### Agent Reference Clarification

The `create-snapshot` skill references "Launch 4 code-explorer agents" with different prompts. This is the correct pattern:
- The agent is defined at `pr/agents/code-explorer.md`
- The skill launches **instances** of that agent with different task prompts
- Skills do NOT need their own agents folder

## Progress Log

### 2026-01-28 - Phase 1 (Remove duplicates)

- Analyzed documentation on skills vs commands
- Confirmed skills take precedence when both exist
- Deleted duplicate command files with embedded content
- Verified agent references are correct
- Committed changes: `c6e24ce`

### 2026-01-28 - Phase 2 (Add wrapper commands)

- Created thin wrapper commands that delegate to skills
- Commands provide frontmatter for discoverability
- Skills contain full workflow logic
- Pending commit

## Files Modified

| Action | File | Notes |
|--------|------|-------|
| Deleted then Created | `pr/commands/create-prd.md` | 450 lines → 7 lines (wrapper) |
| Deleted then Created | `pr/commands/create-snapshot.md` | 564 lines → 7 lines (wrapper) |

## Notes & Decisions

- Commands provide entry points with descriptions; skills provide implementation
- This separation allows skills to have supporting files (templates, examples) while commands stay minimal
- The wrapper pattern: command frontmatter + "Use the `skill-name` skill to..."
