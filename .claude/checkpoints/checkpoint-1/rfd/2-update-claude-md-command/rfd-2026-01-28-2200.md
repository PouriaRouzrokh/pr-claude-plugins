# RFD-2: Update CLAUDE.md Command

## Metadata

- **Created**: 2026-01-28 22:00
- **Last Updated**: 2026-01-28 22:00
- **Status**: Completed
- **Checkpoint**: checkpoint-1

## Feature Request

### Original Request

Create a new command `/pr:update-claude-md` to update CLAUDE.md files with the current project state and development principles. The command should:

1. Keep CLAUDE.md files concise (not bloating context window)
2. Ensure key development principles are always included:
   - Create RFDs for significant changes (not one-line fixes)
   - Use Context7 MCP for package documentation
   - Use agent-browser skill for UI testing
   - Always test changes before handing off to user
   - Always start by planning, especially for RFDs
3. Handle multiple CLAUDE.md files in a repository
4. Read from existing checkpoints/snapshots instead of running agents (efficient)
5. Move CLAUDE.md-specific content out of the `/pr:update-docs` command

### Clarified Requirements

- Command (not skill) since it's a single file with no supporting files
- Reads project context from existing checkpoints/snapshots (no agent exploration)
- Enforces a "Development Principles" section in all CLAUDE.md files
- Includes Documentation Hierarchy section explaining checkpoint system
- Target length: under 200 lines per CLAUDE.md file
- Falls back to README.md/package.json if no checkpoints exist

### Out of Scope

- Creating new CLAUDE.md files (only updates existing ones)
- Running code-explorer agents (uses checkpoint system instead)

## Context

### Related Existing Features

- `/pr:update-docs` - Updates project documentation (now excludes CLAUDE.md)
- `/pr:create-snapshot` - Creates technical snapshots that this command reads from
- `/pr:feature-dev` - Feature development with RFD tracking

### Key Files & Components

- `pr/commands/update-docs.md` - Modified to remove CLAUDE.md handling
- `pr/commands/update-claude-md.md` - New command file
- `CLAUDE.md` - Updated to document new command

### Technical Constraints

- Must read from checkpoint system, not run agents
- Keep CLAUDE.md files under 200 lines

## Implementation Plan

### Chosen Architecture

Simple command that:
1. Discovers all CLAUDE.md files
2. Reads existing content
3. Reads latest checkpoint/snapshot for project context
4. Updates each file with required sections (Development Principles, Documentation Hierarchy)
5. Preserves project-specific customizations

### Implementation Phases

1. Create command file with proper frontmatter
2. Define phases: discover files → read existing → read checkpoints → update files
3. Include required section templates (Development Principles, Documentation Hierarchy)
4. Update `/pr:update-docs` to reference new command
5. Update project CLAUDE.md to document new command

## Progress Log

### 2026-01-28 - Initial Implementation

- Created RFD
- Initially created as a skill (`pr/skills/update-claude-md/SKILL.md`)
- User feedback: should be a command, not a skill (single file, no supporting files)
- Converted to command (`pr/commands/update-claude-md.md`)
- Deleted skill directory
- User feedback: no need for agents, read from checkpoints instead
- Updated Phase 3 to read from checkpoints instead of running agents
- Updated `/pr:update-docs` to remove CLAUDE.md handling (Phase 5.5 removed)
- Updated project `CLAUDE.md` to document new command in Commands table

## Notes & Decisions

1. **Command vs Skill**: Chose command because there are no supporting files needed. Skills are for more complex features with templates, examples, or scripts.

2. **No Agents**: Reading from checkpoints is more efficient than running code-explorer agents. The snapshot already contains all the project context needed.

3. **Required Sections**: Every CLAUDE.md must include:
   - Development Principles (RFD workflow, Context7 for docs, agent-browser for UI testing, testing requirements)
   - Documentation Hierarchy (explains checkpoint system)

4. **Conciseness**: Target < 200 lines to avoid bloating Claude's context window.

## Files Changed

- `pr/commands/update-claude-md.md` - Created (new command)
- `pr/commands/update-docs.md` - Modified (removed CLAUDE.md handling)
- `CLAUDE.md` - Modified (added new command to table, added Skills section)
